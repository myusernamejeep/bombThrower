/**
* PreloadJS
* Visit http://createjs.com/ for documentation, updates and examples.
*
* Copyright (c) 2012 Grant Skinner
* 
* Permission is hereby granted, free of charge, to any person
* obtaining a copy of this software and associated documentation
* files (the "Software"), to deal in the Software without
* restriction, including without limitation the rights to use,
* copy, modify, merge, publish, distribute, sublicense, and/or sell
* copies of the Software, and to permit persons to whom the
* Software is furnished to do so, subject to the following
* conditions:
* 
* The above copyright notice and this permission notice shall be
* included in all copies or substantial portions of the Software.
* 
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
* EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
* OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
* NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
* HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
* WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
* FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
* OTHER DEALINGS IN THE SOFTWARE.
**/
(function(i){function a(){throw"SoundJS cannot be instantiated";}function f(a,b){this.init(a,b)}a.DELIMITER="|";a.AUDIO_TIMEOUT=8E3;a.INTERRUPT_ANY="any";a.INTERRUPT_EARLY="early";a.INTERRUPT_LATE="late";a.INTERRUPT_NONE="none";a.PLAY_INITED="playInited";a.PLAY_SUCCEEDED="playSucceeded";a.PLAY_INTERRUPTED="playInterrupted";a.PLAY_FINISHED="playFinished";a.PLAY_FAILED="playFailed";a.activePlugin=null;a.pluginsRegistered=false;a.masterVolume=1;a.muted=false;a.instances=[];a.instanceHash={};a.idHash=
null;a.getPreloadHandlers=function(){return{callback:a.proxy(a.initLoad,a),types:["sound"],extensions:["mp3","ogg","wav"]}};a.registerPlugins=function(c){a.pluginsRegistered=true;for(var b=0,d=c.length;b<d;b++){var e=c[b];if(e!=null&&e.isSupported())return a.activePlugin=new e,true}return false};a.registerPlugin=function(c){a.pluginsRegistered=true;return c.isSupported()?(a.activePlugin=new c,a.log("initialize "+a.activePlugin.toString()),true):false};a.isReady=function(){return a.activePlugin!=null};
a.getCapabilities=function(){return a.activePlugin?a.activePlugin.capabilities:null};a.getCapability=function(c){return a.activePlugin==null?null:a.activePlugin.capabilities[c]};a.initLoad=function(c,b,d,e){if(!a.checkPlugin(true))return false;c=a.parsePath(c,b,d,e);if(c==null)return false;if(d!=null){if(a.idHash==null)a.idHash={};a.idHash[d]=c.src}f.create(c.src,e);d=a.activePlugin.register(c.src,e);if(d!=null){if(d.tag!=null)c.tag=d.tag;else if(d.src)c.src=d.src;if(d.completeHandler!=null)c.handler=
d.completeHandler}return c};a.parsePath=function(c,b,d,e){for(var c=c.split(a.DELIMITER),b={type:b||"sound",id:d,data:e,handler:a.handleSoundReady},d=false,e=a.getCapabilities(),g=0,k=c.length;g<k;g++){var f=c[g],j=f.lastIndexOf("."),i=f.substr(j+1).toLowerCase(),j=f.substr(0,j).split("/").pop();switch(i){case "mp3":e.mp3&&(d=true);break;case "ogg":e.ogg&&(d=true);break;case "wav":e.wav&&(d=true)}if(d)return b.name=j,b.src=f,b.extension=i,b}return null};a.play=function(c,b,d,e,g,f,h){if(!a.checkPlugin(true))return null;
c=a.getSrcFromId(c);c=a.activePlugin.create(c);return a.playInstance(c,b,d,e,g,f,h)};a.playInstance=function(c,b,d,e,g,f,h){b=b||a.INTERRUPT_NONE;d==null&&(d=0);e==null&&(e=0);g==null&&(g=0);f==null&&(f=1);h==null&&(h=0);if(d==0){if(!a.beginPlaying(c,b,e,g,f,h))return null}else setTimeout(function(){a.beginPlaying(c,b,e,g,f,h)},d);this.instances.push(c);return this.instanceHash[c.uniqueId]=c};a.beginPlaying=function(a,b,d,e,g,k){if(!f.add(a,b))return false;return a.beginPlaying(d,e,g,k)==-1?(this.instances.splice(this.instances.indexOf(a),
1),delete this.instanceHash[a.uniqueId],false):true};a.checkPlugin=function(c){return a.activePlugin==null&&(c&&!a.pluginsRegistered&&a.registerPlugin(a.HTMLAudioPlugin),a.activePlugin==null)?(a.log("*** No Active Plugin Found on SoundJS"),false):true};a.getSrcFromId=function(c){return a.idHash==null||a.idHash[c]==null?c:a.idHash[c]};a.setVolume=function(c,b){if(Number(c)==null)return false;c=Math.max(0,Math.min(1,c));return a.tellAllInstances("setVolume",b,c)};a.getMasterVolume=function(){return a.masterVolume};
a.setMasterVolume=function(c){a.masterVolume=c;return a.tellAllInstances("setMasterVolume",null,c)};a.setMute=function(c,b){return a.tellAllInstances("mute",b,c)};a.pause=function(c){return a.tellAllInstances("pause",c)};a.resume=function(c){return a.tellAllInstances("resume",c)};a.stop=function(c){return a.tellAllInstances("stop",c)};a.getInstanceById=function(a){return this.instanceHash[a]};a.playFinished=function(a){f.remove(a);this.instances.splice(this.instances.indexOf(a),1)};a.tellAllInstances=
function(a,b,d){if(this.activePlugin==null)return false;for(var b=this.getSrcFromId(b),e=this.instances.length-1;e>=0;e--){var g=this.instances[e];if(!(b!=null&&g.src!=b))switch(a){case "pause":g.pause();break;case "resume":g.resume();break;case "setVolume":g.setVolume(d);break;case "setMasterVolume":g.setMasterVolume(d);break;case "mute":g.mute(d);break;case "stop":g.stop();break;case "setPan":g.setPan(d)}}return true};a.proxy=function(a,b){return function(){return a.apply(b,arguments)}};a.log=function(){};
i.SoundJS=a;f.channels={};f.create=function(a,b){var d=f.get(a);d==null?f.channels[a]=new f(a,b):d.max+=b};f.add=function(a,b){var d=f.get(a.src);return d==null?false:d.add(a,b)};f.remove=function(a){var b=f.get(a.src);if(b==null)return false;b.remove(a);return true};f.get=function(a){return f.channels[a]};f.prototype={src:null,max:null,length:0,init:function(a,b){this.src=a;this.max=b||1;this.instances=[]},get:function(a){return this.instances[a]},add:function(a,b){if(!this.getSlot(b,a))return false;
this.instances.push(a);this.length++;return true},remove:function(a){a=this.instances.indexOf(a);if(a==-1)return false;this.instances.splice(a,1);this.length--;return true},getSlot:function(c){for(var b,d,e=0,g=this.max||100;e<g;e++){b=this.get(e);if(b==null)return true;else if(c==a.INTERRUPT_NONE)continue;if(e==0)d=b;else if(b.playState==a.PLAY_FINISHED||b==a.PLAY_INTERRUPTED||b==a.PLAY_FAILED)d=b;else if(c==a.INTERRUPT_EARLY&&b.getPosition()<d.getPosition()||c==a.INTERRUPT_LATE&&b.getPosition()>
d.getPosition())d=b}return d!=null?(d.interrupt(),this.remove(d),true):false},toString:function(){return"[SoundJS SoundChannel]"}}})(window);(function(i){function a(){this.init()}function f(b){this.init(b)}function c(b){this.init(b)}a.MAX_INSTANCES=30;a.capabilities=null;a.lastId=0;a.AUDIO_READY="canplaythrough";a.AUDIO_ENDED="ended";a.AUDIO_ERROR="error";a.AUDIO_STALLED="stalled";a.fillChannels=false;a.isSupported=function(){if(BrowserDetect&&BrowserDetect.isIOS)return false;a.generateCapabilities();var b=a.tag;return b==null||b.canPlayType==null?false:true};a.generateCapabilities=function(){if(a.capabilities==null){var b=a.tag=document.createElement("audio");
a.capabilities={panning:false,volume:true,mp3:b.canPlayType("audio/mp3")!="no"&&b.canPlayType("audio/mp3")!="",ogg:b.canPlayType("audio/ogg")!="no"&&b.canPlayType("audio/ogg")!="",mpeg:b.canPlayType("audio/mpeg")!="no"&&b.canPlayType("audio/mpeg")!="",channels:a.MAX_INSTANCES}}};a.prototype={capabilities:null,FT:0.0010,channels:null,init:function(){this.capabilities=a.capabilities;this.channels={}},register:function(b,a){for(var e=c.get(b),g,f=0,h=a||1;f<h;f++)g=this.createTag(b),e.add(g);return{tag:g}},
createTag:function(b){var a=document.createElement("audio");a.preload=false;a.src=b;return a},create:function(b){b=new f(b);b.owner=this;return b},toString:function(){return"[HTMLAudioPlugin]"}};i.SoundJS.HTMLAudioPlugin=a;f.prototype={src:null,uniqueId:-1,playState:null,owner:null,loaded:false,paused:false,lastInterrupt:SoundJS.INTERRUPT_NONE,offset:0,delay:0,volume:1,pan:0,muted:false,remainingLoops:0,delayTimeout:-1,tag:null,onComplete:null,onLoop:null,onReady:null,onPlayFailed:null,onPlayInterrupted:null,
endedHandler:null,readyHandler:null,stalledHandler:null,init:function(b){this.uniqueId=a.lastId++;this.src=b;this.endedHandler=SoundJS.proxy(this.handleSoundComplete,this);this.readyHandler=SoundJS.proxy(this.handleSoundReady,this);this.stalledHandler=SoundJS.proxy(this.handleSoundStalled,this)},cleanUp:function(){var b=this.tag;if(b!=null){b.pause();try{b.currentTime=0}catch(d){}b.removeEventListener(a.AUDIO_ENDED,this.endedHandler,false);b.removeEventListener(a.AUDIO_READY,this.readyHandler,false);
c.setInstance(this.src,b);this.tag=null}SoundJS.playFinished(this)},interrupt:function(){if(this.tag!=null){this.playState=SoundJS.PLAY_INTERRUPTED;if(this.onPlayInterrupted)this.onPlayInterrupted(this);this.cleanUp();this.paused=false}},play:function(b,a,c,g,f,h){this.cleanUp();SoundJS.playInstance(this,b,a,c,g,f,h)},beginPlaying:function(b,d,e){var g=this.tag=c.getInstance(this.src);if(g==null)return this.playFailed(),-1;g.addEventListener(a.AUDIO_ENDED,this.endedHandler,false);this.offset=b;this.volume=
e;this.updateVolume();this.remainingLoops=d;g.readyState!==4?(g.addEventListener(a.AUDIO_READY,this.readyHandler,false),g.addEventListener(a.AUDIO_STALLED,this.stalledHandler,false),g.load()):this.handleSoundReady(null);return 1},handleSoundStalled:function(){SoundJS.log("* Audio Stalled");if(this.onPlayFailed!=null)this.onPlayFailed(this);this.cleanUp()},handleSoundReady:function(){this.playState=SoundJS.PLAY_SUCCEEDED;this.tag.removeEventListener(a.AUDIO_READY,this.readyHandler,false);this.offset>=
this.getDuration()?(SoundJS.log("* Out of range",this.offset,this.tag.currentTime),this.playFailed()):(this.tag.currentTime=this.offset*0.0010,this.tag.play())},pause:function(){this.paused=true;return this.tag!=null?(this.tag.pause(),false):true},resume:function(){this.paused=false;return this.tag!=null?(this.tag.play(),false):true},stop:function(){this.pause();this.playState=SoundJS.PLAY_FINISHED;this.cleanUp();return true},setMasterVolume:function(){this.updateVolume();return true},setVolume:function(b){this.volume=
b;this.updateVolume();return true},updateVolume:function(){return this.tag!=null?(this.tag.volume=this.muted?0:this.volume*SoundJS.masterVolume,true):false},getVolume:function(){return this.volume},mute:function(b){this.muted=b;this.updateVolume();return true},setPan:function(){return false},getPan:function(){return 0},getPosition:function(){return this.tag==null?0:this.tag.currentTime*1E3},setPosition:function(b){if(this.tag==null)return false;try{this.tag.currentTime=b*0.0010}catch(a){return false}return true},
getDuration:function(){return this.tag==null?0:this.tag.duration*1E3},handleSoundComplete:function(){if(this.remainingLoops!=0){this.remainingLoops--;try{this.tag.currentTime=0}catch(b){}this.tag.play();if(this.onLoop!=null)this.onLoop(this)}else{this.playState=SoundJS.PLAY_FINISHED;if(this.onComplete!=null)this.onComplete(this);this.cleanUp()}},playFailed:function(){this.playState=SoundJS.PLAY_FAILED;if(this.onPlayFailed!=null)this.onPlayFailed(this);this.cleanUp()},toString:function(){return"[HTMLAudio SoundInstance]"}};
c.channels={};c.get=function(b){var a=c.channels[b];a==null&&(a=c.channels[b]=new c(b));return a};c.getInstance=function(a){a=c.channels[a];return a==null?null:a.get()};c.setInstance=function(a,d){var e=c.channels[a];return e==null?null:e.set(d)};c.prototype={src:null,length:0,available:0,tags:null,init:function(a){this.src=a;this.tags=[]},add:function(a){this.tags.push(a);this.length++;this.available=this.tags.length},get:function(){if(this.tags.length==0)return null;this.available=this.tags.length;
var a=this.tags.pop();document.body.appendChild(a);return a},set:function(a){this.tags.indexOf(a)==-1&&this.tags.push(a);document.body.removeChild(a);this.available=this.tags.length},toString:function(){return"[HTMLAudioPlugin TagChannel]"}}})(window);(function(i){function a(){this.init()}function f(a,d){this.init(a,d)}function c(a,d){this.init(a,d)}a.capabilities=null;a.BASE_PATH="src/soundjs";a.lastId=0;a.isSupported=function(){if(BrowserDetect&&BrowserDetect.isIOS)return false;a.generateCapabilities();return swfobject==null?false:swfobject.hasFlashPlayerVersion("9.0.0")};a.generateCapabilities=function(){if(a.capabilities==null)a.capabilities={panning:true,volume:true,mp3:true,ogg:false,mpeg:true,channels:255}};a.prototype={CONTAINER_ID:"flashAudioContainer",
capabilities:null,container:null,flash:null,flashReady:false,flashInstances:null,flashPreloadInstances:null,queuedInstances:null,init:function(){this.capabilities=a.capabilities;this.flashInstances={};this.flashPreloadInstances={};this.queuedInstances=[];var b=this.container=document.createElement("div");b.id=this.CONTAINER_ID;b.appendChild(document.createTextNode("Default Content Here"));document.body.appendChild(b);swfobject.embedSWF(a.BASE_PATH+"FlashAudioPlugin.swf",this.CONTAINER_ID,"1","1",
"9.0.0",null,null,null,null,SoundJS.proxy(this.handleSWFReady,this))},handleSWFReady:function(a){this.flash=a.ref;this.loadTimeout=setTimeout(function(){SoundJS.proxy(this.handleTimeout,this)},2E3)},handleFlashReady:function(){this.flashReady=true;for(var a=0,d=this.queuedInstances.length;a<d;a++)this.flash.register(this.queuedInstances[a]);this.queuedInstances=null;for(var c in this.flashPreloadInstances)this.flashPreloadInstances[c].initialize(this.flash);for(c in this.flashInstances)this.flashInstances[c].initialize(this.flash)},
handleTimeout:function(){SoundJS.log("Flash Load Error")},register:function(a){this.flashReady?this.flash.register(a):this.queuedInstances.push(a);return{tag:new c(a,this.flash)}},create:function(a){try{var d=new f(a,this.flash);d.owner=this;return d}catch(c){SoundJS.log("Error: Please ensure you have permission to play audio from this location.",c)}return null},registerPreloadInstance:function(a,c){this.flashPreloadInstances[a]=c},unregisterPreloadInstance:function(a){delete this.flashPreloadInstances[a]},
registerSoundInstance:function(a,c){this.flashInstances[a]=c},unregisterSoundInstance:function(a){delete this.flashInstances[a]},handleSoundEvent:function(a,c){var e=this.flashInstances[a];if(e!=null){for(var g=[],f=2,h=arguments.length;f<h;f++)g.push(arguments[f]);try{if(g.length==0)e[c]();else e[c].apply(e,g)}catch(i){}}},handlePreloadEvent:function(a,c){var e=this.flashPreloadInstances[a];if(e!=null){for(var g=[],f=2,h=arguments.length;f<h;f++)g.push(arguments[f]);try{if(g.length==0)e[c]();else e[c].apply(e,
g)}catch(i){}}},handleEvent:function(a){switch(a){case "ready":clearTimeout(this.loadTimeout),this.handleFlashReady()}},handleErrorEvent:function(a){SoundJS.log("Handle Error Event",a)},toString:function(){return"[FlashPlugin]"}};i.SoundJS.FlashPlugin=a;f.prototype={src:null,uniqueId:-1,capabilities:null,flash:null,flashId:null,loop:0,volume:1,pan:0,muted:false,paused:false,onComplete:null,onLoop:null,onReady:null,onPlayFailed:null,onPlayInterrupted:null,init:function(b,c){this.uniqueId=a.lastId++;
this.src=b;this.flash=c},initialize:function(a){this.flash=a},interrupt:function(){this.playState=SoundJS.PLAY_INTERRUPTED;if(this.onPlayInterrupted!=null)this.onPlayInterrupted(this);this.flash.interrupt(this.flashId);this.cleanUp()},cleanUp:function(){this.owner.unregisterSoundInstance(this.flashId);SoundJS.playFinished(this)},play:function(a,c,e,g,f,h){SoundJS.playInstance(this,a,c,e,g,f,h)},beginPlaying:function(a,c,e,f){this.loop=c;this.paused=false;this.flashId=this.flash.playSound(this.src,
a,c,e,f);if(this.flashId==null){if(this.onPlayFailed!=null)this.onPlayFailed(this);this.cleanUp();return-1}this.playState=SoundJS.PLAY_SUCCEEDED;this.owner.registerSoundInstance(this.flashId,this);return 1},pause:function(){this.paused=true;return this.flash.pauseSound(this.flashId)},resume:function(){this.paused=false;return this.flash.resumeSound(this.flashId)},stop:function(){this.playState=SoundJS.PLAY_FINISHED;this.paused=false;var a=this.flash.stopSound(this.flashId);this.cleanUp();return a},
setVolume:function(a){this.volume=a;return this.flash.setVolume(this.flashId,a)},getVolume:function(){return this.volume},mute:function(a){return(this.muted=a)?this.flash.muteSound(this.flashId):this.flash.unmuteSound(this.flashId)},getPan:function(){return this.pan},setPan:function(a){this.pan=a;return this.flash.setPan(this.flashId,a)},getPosition:function(){return this.flash.getPosition(this.flashId)},setPosition:function(a){return this.flash.setPosition(this.flashId,a)},getDuration:function(){return this.flash.getDuration(this.flashId)},
handleSoundFinished:function(){this.playState=SoundJS.PLAY_FINISHED;if(this.onComplete!=null)this.onComplete(this);this.cleanUp()},handleLoop:function(){if(this.onLoop!=null)this.onLoop(this)},toString:function(){return"[FlashPlugin SoundInstance]"}};c.prototype={flash:null,src:null,flashId:null,progress:-1,readyState:0,loading:false,onloaded:null,onprogress:null,onError:null,init:function(a,c){this.src=a;this.flash=c},initialize:function(a){this.flash=a;this.loading&&this.load(this.src)},load:function(a){if(this.flash==
null)return loading=true,false;this.flashId=this.flash.preload(a);this.owner.registerPreloadInstance(this.flashId,this);return true},handleProgress:function(a,c){this.progress=a/c;if(this.onprogress!=null)this.onprogress({loaded:a,total:c,progress:this.progress})},handleComplete:function(){this.progress=1;this.readyState=4;if(this.onloaded!=null)this.onloaded()},handleError:function(a){if(this.onerror!=null)this.onerror(a)},toString:function(){return"[FlashPlugin SoundLoader]"}}})(window);
